<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partite Leggendarie degli Scacchi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .games-list {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            max-height: 700px;
            overflow-y: auto;
        }
        
        .game-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .game-card:hover {
            transform: translateX(5px);
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .game-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8ecff 100%);
        }
        
        .game-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        
        .game-players {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .game-info {
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .viewer-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .game-header h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8em;
        }
        
        .game-header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .board-container {
            max-width: 400px;
            margin: 0 auto 30px;
        }
        
        #board {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            aspect-ratio: 1;
            border: 3px solid #333;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        
        .square {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            user-select: none;
        }
        
        .square.light {
            background: #f0d9b5;
        }
        
        .square.dark {
            background: #b58863;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .move-info {
            text-align: center;
            font-size: 1.2em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .description {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 8px;
            line-height: 1.6;
            color: #2c3e50;
        }
        
        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .games-list {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>♔ Partite Leggendarie degli Scacchi ♚</h1>
            <p class="subtitle">Studia le partite immortali dei più grandi campioni della storia</p>
        </header>
        
        <div class="content">
            <div class="games-list" id="gamesList"></div>
            
            <div class="viewer-section">
                <div class="game-header">
                    <h2 id="currentGameTitle">Seleziona una partita</h2>
                    <p id="currentGameInfo"></p>
                </div>
                
                <div class="board-container">
                    <div id="board"></div>
                </div>
                
                <div class="move-info" id="moveInfo">Mossa 0</div>
                
                <div class="controls">
                    <button onclick="goToStart()">⏮ Inizio</button>
                    <button onclick="previousMove()">◀ Indietro</button>
                    <button onclick="nextMove()">Avanti ▶</button>
                    <button onclick="goToEnd()">Fine ⏭</button>
                    <button onclick="autoPlay()">▶️ Auto</button>
                </div>
                
                <div class="description" id="description"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"></script>
    <script>
        const games = [
            {
                title: "La Partita Immortale",
                players: "Anderssen vs Kieseritzky",
                year: 1851,
                location: "Londra",
                pgn: "1.e4 e5 2.f4 exf4 3.Bc4 Qh4+ 4.Kf1 b5 5.Bxb5 Nf6 6.Nf3 Qh6 7.d3 Nh5 8.Nh4 Qg5 9.Nf5 c6 10.g4 Nf6 11.Rg1 cxb5 12.h4 Qg6 13.h5 Qg5 14.Qf3 Ng8 15.Bxf4 Qf6 16.Nc3 Bc5 17.Nd5 Qxb2 18.Bd6 Bxg1 19.e5 Qxa1+ 20.Ke2 Na6 21.Nxg7+ Kd8 22.Qf6+ Nxf6 23.Be7# 1-0",
                description: "Una delle partite più spettacolari della storia degli scacchi. Anderssen sacrifica entrambe le torri e la regina per ottenere un matto brillante. Questa partita dimostra il potere dell'attacco e della combinazione tattica."
            },
            {
                title: "La Partita Sempreverde",
                players: "Anderssen vs Dufresne",
                year: 1852,
                location: "Berlino",
                pgn: "1.e4 e5 2.Nf3 Nc6 3.Bc4 Bc5 4.b4 Bxb4 5.c3 Ba5 6.d4 exd4 7.O-O d3 8.Qb3 Qf6 9.e5 Qg6 10.Re1 Nge7 11.Ba3 b5 12.Qxb5 Rb8 13.Qa4 Bb6 14.Nbd2 Bb7 15.Ne4 Qf5 16.Bxd3 Qh5 17.Nf6+ gxf6 18.exf6 Rg8 19.Rad1 Qxf3 20.Rxe7+ Nxe7 21.Qxd7+ Kxd7 22.Bf5+ Ke8 23.Bd7+ Kf8 24.Bxe7# 1-0",
                description: "Chiamata 'Sempreverde' per la sua bellezza senza tempo. Anderssen conduce un attacco devastante culminando in un magnifico matto. Un capolavoro di sacrifici coordinati."
            },
            {
                title: "L'Opera Game",
                players: "Morphy vs Duca di Brunswick e Conte Isouard",
                year: 1858,
                location: "Parigi (Teatro dell'Opera)",
                pgn: "1.e4 e5 2.Nf3 d6 3.d4 Bg4 4.dxe5 Bxf3 5.Qxf3 dxe5 6.Bc4 Nf6 7.Qb3 Qe7 8.Nc3 c6 9.Bg5 b5 10.Nxb5 cxb5 11.Bxb5+ Nbd7 12.O-O-O Rd8 13.Rxd7 Rxd7 14.Rd1 Qe6 15.Bxd7+ Nxd7 16.Qb8+ Nxb8 17.Rd8# 1-0",
                description: "Giocata durante una rappresentazione dell'opera 'Il Barbiere di Siviglia'. Morphy, il prodigio americano, annienta i suoi nobili avversari con un gioco brillante e sacrifici spettacolari."
            },
            {
                title: "La Partita del Secolo",
                players: "Byrne vs Fischer",
                year: 1956,
                location: "New York",
                pgn: "1.Nf3 Nf6 2.c4 g6 3.Nc3 Bg7 4.d4 O-O 5.Bf4 d5 6.Qb3 dxc4 7.Qxc4 c6 8.e4 Nbd7 9.Rd1 Nb6 10.Qc5 Bg4 11.Bg5 Na4 12.Qa3 Nxc3 13.bxc3 Nxe4 14.Bxe7 Qb6 15.Bc4 Nxc3 16.Bc5 Rfe8+ 17.Kf1 Be6 18.Bxb6 Bxc4+ 19.Kg1 Ne2+ 20.Kf1 Nxd4+ 21.Kg1 Ne2+ 22.Kf1 Nc3+ 23.Kg1 axb6 24.Qb4 Ra4 25.Qxb6 Nxd1 26.h3 Rxa2 27.Kh2 Nxf2 28.Re1 Rxe1 29.Qd8+ Bf8 30.Nxe1 Bd5 31.Nf3 Ne4 32.Qb8 b5 33.h4 h5 34.Ne5 Kg7 35.Kg1 Bc5+ 36.Kf1 Ng3+ 37.Ke1 Bb4+ 38.Kd1 Bb3+ 39.Kc1 Ne2+ 40.Kb1 Nc3+ 41.Kc1 Rc2# 0-1",
                description: "Un tredicenne Bobby Fischer distrugge Donald Byrne con una combinazione di una profondità straordinaria. Il sacrificio di donna di Fischer e la conseguente caccia al re avversario sono considerati uno dei momenti più brillanti nella storia degli scacchi."
            },
            {
                title: "Kasparov's Immortal",
                players: "Kasparov vs Topalov",
                year: 1999,
                location: "Wijk aan Zee",
                pgn: "1.e4 d6 2.d4 Nf6 3.Nc3 g6 4.Be3 Bg7 5.Qd2 c6 6.f3 b5 7.Nge2 Nbd7 8.Bh6 Bxh6 9.Qxh6 Bb7 10.a3 e5 11.O-O-O Qe7 12.Kb1 a6 13.Nc1 O-O-O 14.Nb3 exd4 15.Rxd4 c5 16.Rd1 Nb6 17.g3 Kb8 18.Na5 Ba8 19.Bh3 d5 20.Qf4+ Ka7 21.Rhe1 d4 22.Nd5 Nbxd5 23.exd5 Qd6 24.Rxd4 cxd4 25.Re7+ Kb6 26.Qxd4+ Kxa5 27.b4+ Ka4 28.Qc3 Qxd5 29.Ra7 Bb7 30.Rxb7 Qc4 31.Qxf6 Kxa3 32.Qxa6+ Kxb4 33.c3+ Kxc3 34.Qa1+ Kd2 35.Qb2+ Kd1 36.Bf1 Rd2 37.Rd7 Rxd7 38.Bxc4 bxc4 39.Qxh8 Rd3 40.Qa8 c3 41.Qa4+ Ke1 42.f4 f5 43.Kc1 Rd2 44.Qa7 1-0",
                description: "Considerata da molti come una delle partite più belle mai giocate. Kasparov dimostra il suo genio tattico con una serie di sacrifici brillanti e un attacco devastante contro il re avversario."
            },
            {
                title: "La Partita del Ritorno",
                players: "Karpov vs Kasparov",
                year: 1985,
                location: "Mosca (Mondiale, Partita 16)",
                pgn: "1.e4 c5 2.Nf3 e6 3.d4 cxd4 4.Nxd4 Nc6 5.Nb5 d6 6.c4 Nf6 7.N1c3 a6 8.Na3 d5 9.cxd5 exd5 10.exd5 Nb4 11.Be2 Bc5 12.O-O O-O 13.Bf3 Bf5 14.Bg5 Re8 15.Qd2 b5 16.Rad1 Nd3 17.Nab1 h6 18.Bh4 b4 19.Na4 Bd6 20.Bg3 Rc8 21.b3 g5 22.Bxd6 Qxd6 23.g3 Nd7 24.Bg2 Qf6 25.a3 a5 26.axb4 axb4 27.Qa2 Bg6 28.d6 g4 29.Qd2 Kg7 30.f3 Qxd6 31.fxg4 Qd4+ 32.Kh1 Nf6 33.Rf4 Ne4 34.Qxd3 Nf2+ 35.Rxf2 Bxd3 36.Rfd2 Qe3 37.Rxd3 Rc1 38.Nb2 Qf2 39.Nd2 Rxd1+ 40.Nxd1 Re1+ 0-1",
                description: "Una vittoria cruciale per Kasparov nel campionato mondiale che lo portò a diventare il più giovane campione del mondo. Questa partita dimostra la sua profonda comprensione posizionale e la capacità di sfruttare anche i minimi vantaggi."
            }
        ];

        const pieceSymbols = {
            'K': '♔', 'Q': '♕', 'R': '♖', 'B': '♗', 'N': '♘', 'P': '♙',
            'k': '♚', 'q': '♛', 'r': '♜', 'b': '♝', 'n': '♞', 'p': '♟'
        };

        let currentGameIndex = 0;
        let moveHistory = [];
        let currentMoveIndex = 0;
        let autoPlayInterval = null;

        function parseFEN(fen) {
            const board = Array(8).fill(null).map(() => Array(8).fill(null));
            const position = fen.split(' ')[0];
            const ranks = position.split('/');
            
            for (let i = 0; i < 8; i++) {
                let file = 0;
                for (const char of ranks[i]) {
                    if (char >= '1' && char <= '8') {
                        file += parseInt(char);
                    } else {
                        board[i][file] = char;
                        file++;
                    }
                }
            }
            return board;
        }

        function renderBoard(fen) {
            const board = parseFEN(fen);
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            
            for (let rank = 0; rank < 8; rank++) {
                for (let file = 0; file < 8; file++) {
                    const square = document.createElement('div');
                    square.className = 'square ' + ((rank + file) % 2 === 0 ? 'light' : 'dark');
                    const piece = board[rank][file];
                    if (piece) {
                        square.textContent = pieceSymbols[piece] || '';
                    }
                    boardEl.appendChild(square);
                }
            }
        }

        function parseGame(pgn) {
            const positions = [];
            const chess = new Chess();
            
            positions.push(chess.fen());
            
            // Carica il PGN
            chess.load_pgn(pgn);
            
            // Ricomincia dall'inizio
            chess.reset();
            
            // Ottieni tutte le mosse
            const tempChess = new Chess();
            tempChess.load_pgn(pgn);
            const history = tempChess.history({ verbose: true });
            
            // Rigioca tutte le mosse e salva ogni posizione
            chess.reset();
            positions.push(chess.fen());
            
            for (let move of history) {
                chess.move(move.san);
                positions.push(chess.fen());
            }
            
            return positions;
        }

        function displayGamesList() {
            const listContainer = document.getElementById('gamesList');
            listContainer.innerHTML = games.map((g, index) => `
                <div class="game-card ${index === 0 ? 'active' : ''}" onclick="loadGame(${index})">
                    <div class="game-title">${g.title}</div>
                    <div class="game-players">${g.players}</div>
                    <div class="game-info">${g.location}, ${g.year}</div>
                </div>
            `).join('');
        }

        function loadGame(index) {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
            }

            currentGameIndex = index;
            const selectedGame = games[index];
            
            document.querySelectorAll('.game-card').forEach((card, i) => {
                card.classList.toggle('active', i === index);
            });

            moveHistory = parseGame(selectedGame.pgn);
            currentMoveIndex = 0;
            
            document.getElementById('currentGameTitle').textContent = selectedGame.title;
            document.getElementById('currentGameInfo').textContent = `${selectedGame.players} - ${selectedGame.location}, ${selectedGame.year}`;
            document.getElementById('description').textContent = selectedGame.description;
            
            updateBoard();
        }

        function updateBoard() {
            renderBoard(moveHistory[currentMoveIndex]);
            document.getElementById('moveInfo').textContent = `Mossa ${currentMoveIndex} di ${moveHistory.length - 1}`;
        }

        function goToStart() {
            currentMoveIndex = 0;
            updateBoard();
        }

        function previousMove() {
            if (currentMoveIndex > 0) {
                currentMoveIndex--;
                updateBoard();
            }
        }

        function nextMove() {
            if (currentMoveIndex < moveHistory.length - 1) {
                currentMoveIndex++;
                updateBoard();
            }
        }

        function goToEnd() {
            currentMoveIndex = moveHistory.length - 1;
            updateBoard();
        }

        function autoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                return;
            }

            autoPlayInterval = setInterval(() => {
                if (currentMoveIndex < moveHistory.length - 1) {
                    nextMove();
                } else {
                    clearInterval(autoPlayInterval);
                    autoPlayInterval = null;
                }
            }, 1000);
        }

        window.onload = function() {
            displayGamesList();
            loadGame(0);
        };
    </script>
</body>
</html>
