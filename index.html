<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Partite Leggendarie degli Scacchi</title>
  <style>
    body { font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif; background: #f0f0f0; }
    .container { max-width: 1400px; margin: 0 auto; padding: 30px; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
    .content { display: flex; gap: 30px; }
    .games-list { width: 300px; background: #f8f9fa; border-radius: 15px; padding: 20px; max-height: 700px; overflow-y: auto; }
    .game-card { background: white; border-radius: 10px; margin-bottom: 15px; cursor: pointer; border: 2px solid transparent; transition: border-color .3s; }
    .game-card.active { border-color: #3366ee; }
    .viewer-section { flex: 1; padding: 30px; }
    .game-header { margin-bottom: 30px; }
    .board-container { max-width: 400px; margin-bottom: 20px; }
    #board { width: 320px; display: grid; grid-template-columns: repeat(8, 1fr); border: 3px solid #333; box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
    .square { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 2.1em; opacity: 1; } /* pezzi opachi */
    .square.light { background: #f0d9b5; }
    .square.dark { background: #b58863; }
    #movesList { margin-top: 20px; font-size: 1.15em; background: #f8f9fa; border-radius: 10px; padding: 16px; max-width: 400px; min-height: 60px;}
    .controls { margin-top: 16px; }
    button { background: #3366ee; color: white; border: none; padding: 10px 22px; border-radius: 7px; font-size: 1em; margin-right:7px;}
    .move-info { font-size: 1.15em; margin: 16px 0; }
    .description { background: #f8f9fa; border-left: 4px solid #3366ee; padding: 16px; border-radius: 8px; color: #222;}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"></script>
</head>
<body>
  <div class="container">
    <header><h1>Partite Leggendarie degli Scacchi</h1></header>
    <div class="content">
      <div class="games-list" id="gamesList"></div>
      <div class="viewer-section">
        <div class="game-header">
          <h2 id="currentGameTitle">Seleziona una partita</h2>
          <p id="currentGameInfo"></p>
        </div>
        <div class="board-container">
          <div id="board"></div>
        </div>
        <div class="move-info" id="moveInfo">Mossa 0</div>
        <div class="controls">
          <button onclick="goToStart()">Inizio</button>
          <button onclick="previousMove()">Indietro</button>
          <button onclick="nextMove()">Avanti</button>
          <button onclick="goToEnd()">Fine</button>
          <button onclick="autoPlay()">Auto</button>
        </div>
        <div id="movesList"></div>
        <div class="description" id="description"></div>
      </div>
    </div>
  </div>
  <script>
    // Aggiungi qui altre partite usando lo stesso formato
    const games = [
      {
        title: "La Partita Immortale",
        players: "Anderssen vs Kieseritzky",
        year: 1851,
        location: "Londra",
        pgn: "1.e4 e5 2.f4 exf4 3.Bc4 Qh4 4.Kf1 b5 5.Bxb5 Nf6 6.Nf3 Qh6 7.d3 Nh5 8.Nh4 Qg5 9.Nf5 c6 10.g4 Nf6 11.Rg1 cxb5 12.h4 Qg6 13.h5 Qg5 14.Qf3 Ng8 15.Bxf4 Qf6 16.Nc3 Bc5 17.Nd5 Qxb2 18.Bd6 Bxg1 19.e5 Qxa1 20.Ke2 Na6 21.Nxg7 Kd8 22.Qf6 Nxf6 23.Be7 1-0",
        description: "Una delle partite più spettacolari della storia degli scacchi. Anderssen sacrifica entrambe le torri e la regina per ottenere un matto brillante."
      },
      // ...altre partite, copia il formato e cambia titolo, giocatori, pgn e descrizione!
    ];

    const pieceSymbols = {
      K: "♔", Q: "♕", R: "♖", B: "♗", N: "♘", P: "♙",
      k: "♚", q: "♛", r: "♜", b: "♝", n: "♞", p: "♟"
    };
    let currentGameIndex = 0, moveHistory, currentMoveIndex = 0, autoPlayInterval = null;

    function parseFEN(fen) {
      const board = Array(8).fill(null).map(() => Array(8).fill(null));
      const ranks = fen.split(" ")[0].split("/");
      for (let i = 0; i < 8; i++) {
        let file = 0;
        for (const char of ranks[i]) {
          if (+char) file += +char;
          else board[i][file++] = char;
        }
      }
      return board;
    }
    function renderBoard(fen) {
      const board = parseFEN(fen);
      const boardEl = document.getElementById("board");
      boardEl.innerHTML = "";
      for(let rank=0; rank<8; rank++) {
        for(let file=0; file<8; file++) {
          const square = document.createElement("div");
          square.className = "square " + ((rank+file)%2==0 ? "light" : "dark");
          const piece = board[rank][file];
          if(piece) square.textContent = pieceSymbols[piece] || piece;
          boardEl.appendChild(square);
        }
      }
    }
    function parseGame(pgn) {
      const positions = [];
      const chess = new Chess();
      chess.load_pgn(pgn);
      positions.push(chess.fen());
      chess.reset();
      const history = chess.history({verbose:true});
      for(let move of history){
        chess.move(move.san);
        positions.push(chess.fen());
      }
      return {positions, history};
    }
    function displayGamesList() {
      const listContainer = document.getElementById("gamesList");
      listContainer.innerHTML = games.map((g,i) => 
        `<div class="game-card${i===currentGameIndex?' active':''}" onclick="loadGame(${i})">
          <div><b>${g.title}</b></div>
          <div>${g.players}</div>
          <div class="game-info">${g.location}, ${g.year}</div>
        </div>`
      ).join("");
    }
    function loadGame(index) {
      if(autoPlayInterval) clearInterval(autoPlayInterval); autoPlayInterval=null;
      currentGameIndex = index;
      const selectedGame = games[index];
      document.querySelectorAll(".game-card").forEach((card, i) => card.classList.toggle("active", i===index));
      const gameData = parseGame(selectedGame.pgn);
      moveHistory = gameData.history;
      positions = gameData.positions;
      currentMoveIndex = 0;
      document.getElementById("currentGameTitle").textContent = selectedGame.title;
      document.getElementById("currentGameInfo").textContent = `${selectedGame.players} - ${selectedGame.location}, ${selectedGame.year}`;
      document.getElementById("description").textContent = selectedGame.description;
      updateBoard();
    }
    function updateBoard() {
      renderBoard(positions[currentMoveIndex]);
      // conta mossa combinata
      const moveNum = Math.floor(currentMoveIndex/2);
      const totalMoves = Math.floor((positions.length - 1)/2);
      document.getElementById("moveInfo").textContent = `Mossa ${moveNum} di ${totalMoves}`;
      renderMovesList(moveHistory, currentMoveIndex);
    }
    function renderMovesList(history, upTo) {
      let html = "<ol>";
      for(let i=0; i<upTo; i+=2){
        let white = history[i]?history[i].san:"";
        let black = history[i+1]?history[i+1].san:"";
        html += `<li>${white} ${black}</li>`;
      }
      html += "</ol>";
      document.getElementById("movesList").innerHTML = html;
    }
    function goToStart() { currentMoveIndex=0; updateBoard(); }
    function previousMove() { if(currentMoveIndex>0) currentMoveIndex--; updateBoard(); }
    function nextMove() { if(currentMoveIndex < positions.length-1) currentMoveIndex++; updateBoard(); }
    function goToEnd() { currentMoveIndex=positions.length-1; updateBoard(); }
    function autoPlay() {
      if(autoPlayInterval) { clearInterval(autoPlayInterval); autoPlayInterval=null; return; }
      autoPlayInterval = setInterval(() => {
        if(currentMoveIndex < positions.length-1) nextMove();
        else { clearInterval(autoPlayInterval); autoPlayInterval=null; }
      }, 1000);
    }
    window.onload = function() { displayGamesList(); loadGame(0); };
  </script>
</body>
</html>
